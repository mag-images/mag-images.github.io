<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://use.typekit.net/xix1yoh.css">
    <!-- Primary Meta Tags -->
    <title>aAh! Instagram Story Generator</title>
    <meta name="title" content="aAh! Instagram Story Generator">
    <meta name="description"
        content="A simple tool to generate an Instagram story image for aAh Magazine. Simply fill in the details of the article below and then a story image will be produced">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://mag-images.github.io/">
    <meta property="og:title" content="aAh! Instagram Story Generator">
    <meta property="og:description"
        content="A simple tool to generate an Instagram story image for aAh Magazine. Simply fill in the details of the article below and then a story image will be produced">
    <meta property="og:image" content="https://mag-images.github.io/meta.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://mag-images.github.io/">
    <meta property="twitter:title" content="aAh! Instagram Story Generator">
    <meta property="twitter:description"
        content="A simple tool to generate an Instagram story image for aAh Magazine. Simply fill in the details of the article below and then a story image will be produced">
    <meta property="twitter:image" content="https://mag-images.github.io/meta.png">
    <style>
        canvas#generatedImage {

            outline: 1px solid grey;
            transform: scale(50%);
            transform-origin: top left;
            margin: 0;
            margin-right: -540px;
            margin-bottom: -960px
        }

        body {
            font-family: "itc-avant-garde-gothic-pro", sans-serif;
            margin: 0;
            padding: 0;
        }

        main {
            display: flex;
            flex-direction: row;
        }


        h5 {
            color: #da0974;

        }

        h5 {
            font-size: 1.5rem;
            margin-bottom: 10px;


        }

        header {
            padding: 20px 20px 20px 50px;
            background-color: #da0974;
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            align-items: center;
            justify-content: flex-start;
            gap: 20px;
        }

        header img,
        header h1 {
            display: inline-block;
            margin: 0;
        }

        h1 {
            color: white;
        }

        p {
            color: grey;
        }

        header p {
            color: white;
        }

        #controls {
            margin: 20px;
        }

        input {
            padding: 10px;
            border-radius: 10px;
        }

        input[type="file"] {
            display: none;
        }

        main button,
        main a,
        .fileButton {

            background-color: #da0974;
            outline: 0;
            border: 0;
            padding: 10px;
            border-radius: 10px;
            color: white;
            font-family: "itc-avant-garde-gothic-pro", sans-serif;
            font-size: 20px;
        }

        main a.inactive {
            background-color: grey;
        }

        main a.active {
            background-color: #da0974;
            text-decoration: none;
        }

        .fileButton {
            display: inline-block;
        }

        form p,
        form label,
        form input,
        form button,
        form a {
            margin-left: 30px;
        }

        .colourLabel {
            margin-left: unset;
            font-size: 1.2rem;
        }

        input#colourChoice1,
        input#colourChoice2,
        input#colourChoice3 {

            appearance: none;

            border-radius: 50%;
            width: 22px;
            height: 22px;

            transition: 0.2s all linear;
            margin-right: 5px;

            position: relative;
            top: 4px;
            border: 2px grey solid;
            padding: unset;

        }

        input#colourChoice1:checked {
            border: 10px #da0974 solid;
        }

        input#colourChoice2:checked {
            border: 10px #195f72 solid;
        }

        input#colourChoice3:checked {
            border: 10px #fb5012 solid;
        }

        footer {
            color: grey;
            padding-left: 20px;
        }

        footer a {
            color: #da0974;
        }

        #blurb {
            border: 6px solid #da0974;
            padding: 24px;
            border-radius: 12px;
            margin: 0;
        }

        #preview {
            margin: 20px;
        }

        #preview h3 {
            margin-top: 0;
            padding-top: 26px;
        }
    </style>
</head>

<body>
    <header>
        <img src="logo-small.png" alt="aAh!" width="60px" height="auto">
        <h1>Instagram Story Generator</h1>

    </header>
    <main>
        <section id="controls">

            <h3 id="blurb">A simple tool to generate an Instagram story image for aAh Magazine. Simply fill in the
                details of the article below and then a story image will be produced</h3>
            <form action="POST">


                <h5>1. Type the headline of the article</h5>
                <p>Six or seven lines maximum, ideally less</p>
                <input type="text" id="headline" placeholder="Headline..." required>
                <h5>2. Choose an image for the story</h5>
                <p>Landscape, size 1080 by 1920 pixels if possible. Images of any other aspect ratio will be squashed to
                    fit,
                    which doesn't look nice</p>
                <label for="file" class="fileButton">
                    Choose file
                </label>
                <input type="file" name="file" id="file" accept="image/*" required>
                <h5>3. Pick the colour scheme</h5>
                <p>Pink for most articles, or use orange or blue for a bit of variety</p>
                <input type="radio" id="colourChoice1" name="colour" value="pink" checked required />
                <label for="colourChoice1" class="colourLabel">Pink</label>
                <br>
                <input type="radio" id="colourChoice2" name="colour" value="blue" />
                <label for="colourChoice2" class="colourLabel">Blue</label>
                <br>
                <input type="radio" id="colourChoice3" name="colour" value="orange" />
                <label for="colourChoice3" class="colourLabel">Orange</label>
                <h5>4. Click submit when you've chosen your options</h5>
                <p>A half-size preview will appear to the right.<br>If you make any more changes, click submit again</p>
                <button id="generateButton" type="button" onClick="generate()">Submit</button>

                <h5>5. Click generate when you're happy with it</h5>

                <button id="downloadButton" type="button" onClick="download()">Generate</button>
                <h5>6. Click download and then add to the Instagram</h5>
                <p>Add a link using Instagram's Create mode</p>
                <a id="download" download="download.png" class="inactive">Download</a><br><br><br>

            </form>
        </section>
        <section id="preview">
            <h3>Preview</h3><canvas id="generatedImage" width="1080px" height="1920px">hello</canvas>
        </section>


    </main>
    <footer>
        <p>Site created by <a href="https://www.bradleysans.uk">Bradley Sansom</a></p>
        <p>Version 1.1, built 2022-11-18. <a
                href="https://github.com/mag-images/mag-images.github.io/commits/main">Changelog</a></p>
    </footer>
</body>
<script>
    var canvas = document.getElementById("generatedImage");
    function generate() {
        //get inputs
        var headline = document.getElementById("headline").value;
        var picture = document.getElementById("file");
        var colour = document.getElementsByName("colour");
        for (i = 0; i < colour.length; i++) {
            if (colour[i].checked)
                colour = i;
        }
        console.log(colour);
        if (colour === 0) {
            colour = '#da0974';
        } else if (colour === 1) {
            colour = '#195f72';
        } else if (colour === 2) {
            colour = '#fb5012';
        }

        // set up canvas and background
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = colour;
        ctx.fillRect(0, 0, 1080, 1920);

        // split headline into multiple lines
        function wrapText(context, text, x, y, maxWidth, lineHeight) {
            var words = text.split(' ');
            var line = '';

            for (var n = 0; n < words.length; n++) {
                var testLine = line + words[n] + ' ';
                var metrics = context.measureText(testLine);
                var testWidth = metrics.width;
                if (testWidth > maxWidth && n > 0) {
                    ctx.fillText(line, x, y);
                    line = words[n] + ' ';
                    y += lineHeight;
                }
                else {
                    line = testLine;
                }
            }
            ctx.fillText(line, x, y);
        }

        // add headline
        ctx.fillStyle = 'white';
        ctx.font = '70px "itc-avant-garde-gothic-pro"';

        wrapText(ctx, headline, 50, 300, 900, 70);
        var downloadLink = document.getElementById("download");


        var truncatedHeadline = headline.substring(0, 30);
        downloadLink.setAttribute("download", "Instagram story " + truncatedHeadline + ".png")

        // add image
        let photoSrc = '';
        if (picture.value !== '') {
            photoSrc = window.URL.createObjectURL(picture.files[0]);
        }
        const photo = new Image();
        photo.onload = function () {
            ctx.drawImage(photo, 0, 1230, 1080, 607.5);
        }
        photo.src = photoSrc;



    }
    function download() {
        // generate download link
        var downloadLink = document.getElementById("download");
        var img = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
        downloadLink.setAttribute("href", img);

        downloadLink.classList.add("active");


    }

</script>

</html>